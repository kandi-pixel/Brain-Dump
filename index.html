<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brain Dump</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .header-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 20px;
        }

        .pomodoro {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 15px 25px;
            border-radius: 15px;
            font-size: 1.2em;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .pomodoro-controls {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            justify-content: center;
        }

        .pomodoro-btn {
            background: white;
            color: #f5576c;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .pomodoro-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        .suggest-btn {
            background: linear-gradient(135deg, #FA8BFF 0%, #2BD2FF 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 12px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            transition: all 0.3s;
        }

        .suggest-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        .stats {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            padding: 15px;
            border-radius: 12px;
            display: flex;
            gap: 20px;
            justify-content: center;
            align-items: center;
        }

        .stat-item {
            font-weight: bold;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .tab {
            padding: 12px 24px;
            background: #e0e7ff;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            position: relative;
        }

        .tab:hover {
            background: #c7d2fe;
            transform: translateY(-2px);
        }

        .tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .tab-editable {
            background: none;
            border: none;
            font: inherit;
            color: inherit;
            cursor: pointer;
            padding: 0;
            font-weight: 600;
        }

        .tab-editable:focus {
            outline: 2px solid white;
            border-radius: 4px;
            padding: 2px 4px;
        }

        .board {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .column {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            border-radius: 15px;
            padding: 20px;
            min-height: 400px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .column h2 {
            margin-bottom: 15px;
            color: #2d3748;
            font-size: 1.3em;
            text-align: center;
            cursor: pointer;
            padding: 5px;
            border-radius: 5px;
            transition: background 0.2s;
        }

        .column h2:hover {
            background: rgba(255, 255, 255, 0.5);
        }

        .column h2[contenteditable="true"] {
            outline: 2px solid #667eea;
            background: rgba(255, 255, 255, 0.8);
        }

        .task {
            background: white;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 12px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            cursor: move;
            transition: all 0.3s;
            position: relative;
        }

        .task:hover {
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
            transform: translateY(-2px);
        }

        .task.dragging {
            opacity: 0.5;
            transform: rotate(5deg);
        }

        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            flex-wrap: wrap;
            gap: 8px;
        }

        .task-title {
            font-weight: bold;
            font-size: 1.1em;
            color: #2d3748;
            cursor: text;
            flex: 1;
            padding: 4px;
            border-radius: 4px;
            min-width: 150px;
        }

        .task-title:hover {
            background: #f7fafc;
        }

        .task-title[contenteditable="true"] {
            outline: 2px solid #667eea;
            background: #f7fafc;
        }

        .priority {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
        }

        .priority:hover {
            transform: scale(1.1);
        }

        .priority.high {
            background: #fee;
            color: #c53030;
        }

        .priority.medium {
            background: #fef3c7;
            color: #92400e;
        }

        .priority.low {
            background: #e0f2fe;
            color: #075985;
        }

        .task-meta {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .person-badge {
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.85em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .person-badge:hover {
            transform: scale(1.1);
        }

        .person-badge.james {
            background: #dbeafe;
            color: #1e40af;
        }

        .person-badge.kandra {
            background: #fef3c7;
            color: #92400e;
        }

        .person-badge.both {
            background: #d1fae5;
            color: #065f46;
        }

        .task-purpose {
            flex: 1;
            font-size: 0.9em;
            color: #64748b;
            cursor: text;
            padding: 4px;
            border-radius: 4px;
        }

        .task-purpose:hover {
            background: #f7fafc;
        }

        .task-purpose[contenteditable="true"] {
            outline: 2px solid #667eea;
            background: #f7fafc;
        }

        .task-actions {
            display: flex;
            gap: 8px;
            margin-top: 10px;
        }

        .task-btn {
            flex: 1;
            padding: 8px 12px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 600;
            transition: all 0.2s;
        }

        .delete-btn {
            background: #fee;
            color: #c53030;
        }

        .delete-btn:hover {
            background: #fca5a5;
        }

        .move-btn {
            background: #e0e7ff;
            color: #4338ca;
        }

        .move-btn:hover {
            background: #c7d2fe;
        }

        .add-task-btn {
            width: 100%;
            padding: 12px;
            background: rgba(255, 255, 255, 0.8);
            border: 2px dashed #cbd5e1;
            border-radius: 10px;
            color: #64748b;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .add-task-btn:hover {
            background: white;
            border-color: #667eea;
            color: #667eea;
        }

        .brain-dump {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            border-radius: 15px;
            padding: 25px;
            margin-top: 30px;
        }

        .brain-dump h2 {
            margin-bottom: 15px;
            color: #2d3748;
        }

        .brain-dump-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #cbd5e1;
            border-radius: 10px;
            font-size: 1em;
            font-family: inherit;
            resize: vertical;
            min-height: 60px;
        }

        .brain-dump-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .brain-dump-hint {
            margin-top: 10px;
            font-size: 0.9em;
            color: #64748b;
            font-style: italic;
        }

        .source-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.75em;
            font-weight: 600;
            background: #e0e7ff;
            color: #4338ca;
            margin-left: 8px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e5e7eb;
            border-radius: 10px;
            overflow: hidden;
            margin-top: 5px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s;
        }

        @media (max-width: 768px) {
            .board {
                grid-template-columns: 1fr;
            }

            .header h1 {
                font-size: 1.8em;
            }

            .header-controls {
                flex-direction: column;
            }
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 20px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .modal-content h3 {
            margin-bottom: 15px;
            color: #667eea;
        }

        .modal-content ul {
            list-style: none;
            padding: 0;
        }

        .modal-content li {
            padding: 10px;
            margin: 5px 0;
            background: #f7fafc;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .modal-content li:hover {
            background: #e0e7ff;
            transform: translateX(5px);
        }

        .close-modal {
            margin-top: 20px;
            padding: 10px 20px;
            background: #e5e7eb;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }

        .close-modal:hover {
            background: #cbd5e1;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üß† Brain Dump</h1>

            <div class="header-controls">
                <div class="pomodoro">
                    <div id="timer">25:00</div>
                    <div class="pomodoro-controls">
                        <button class="pomodoro-btn" onclick="startTimer()">‚ñ∂Ô∏è Start</button>
                        <button class="pomodoro-btn" onclick="pauseTimer()">‚è∏Ô∏è Pause</button>
                        <button class="pomodoro-btn" onclick="resetTimer()">üîÑ Reset</button>
                    </div>
                </div>

                <button class="suggest-btn" onclick="suggestNextTask()">
                    ‚ú® What Should I Do NOW?
                </button>

                <div class="stats">
                    <div class="stat-item">
                        Today: <span id="todayCount">0</span> tasks
                    </div>
                    <div class="stat-item">
                        Done: <span id="doneCount">0</span>
                    </div>
                    <div class="stat-item">
                        Progress: <span id="progressPercent">0</span>%
                    </div>
                </div>
            </div>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchPage('fullboard')">Full Board</button>
            <button class="tab" onclick="switchPage('taxseason')" ondblclick="editTab(this, 'taxseason')">
                <span class="tab-editable">Tax Season</span>
            </button>
            <button class="tab" onclick="switchPage('languageschool')" ondblclick="editTab(this, 'languageschool')">
                <span class="tab-editable">Language School</span>
            </button>
            <button class="tab" onclick="switchPage('appdev')" ondblclick="editTab(this, 'appdev')">
                <span class="tab-editable">App Dev</span>
            </button>
            <button class="tab" onclick="switchPage('immigration')" ondblclick="editTab(this, 'immigration')">
                <span class="tab-editable">Immigration/Apartment</span>
            </button>
        </div>

        <div id="board" class="board"></div>

        <div class="brain-dump">
            <h2>üß† Brain Dump</h2>
            <textarea
                class="brain-dump-input"
                id="brainDumpInput"
                placeholder="Just type whatever's in your head... I'll organize it for you!"
                onkeydown="handleBrainDumpEnter(event)"
            ></textarea>
            <div class="brain-dump-hint">
                üí° Try: "Call dentist tmr james" or "Buy groceries today both urgent" or "Research visa stuff kandra"
            </div>
        </div>
    </div>

    <div class="modal" id="moveModal">
        <div class="modal-content">
            <h3>Move Task To...</h3>
            <ul id="moveOptions"></ul>
            <button class="close-modal" onclick="closeMoveModal()">Cancel</button>
        </div>
    </div>

    <audio id="timerAlert">
        <source src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBTGH0fPTgjMGHm7A7+OZSR4NXK3n7q5aGA1Lpd/yuWcfCDSN0/PQfS4HImS47t6YUBkPXK3n7q5aGA1Lpd/yuWcfCDSN0/PQfS4HImS47t6YUBkPXK3n7q5aGA1Lpd/yuWcfCDSN0/PQfS4HImS47t6YUBkPXK3n7q5aGA1Lpd/yuWcfCDSN0/PQfS4HImS47t6YUBkPXK3n7q5aGA1Lpd/yuWcfCDSN0/PQfS4HImS47t6YUBkPXK3n7q5aGA1Lpd/yuWcfCDSN0/PQfS4HImS47t6YUBkP" type="audio/wav">
    </audio>

    <script>
        let currentPage = 'fullboard';
        let timerInterval = null;
        let timerSeconds = 25 * 60;
        let isWorkTime = true;
        let taskIdCounter = 0;
        let draggedTask = null;
        let currentMoveTask = null;

        const pages = {
            fullboard: {
                name: 'Full Board',
                columns: ['Today', 'This Week', 'This Month', 'Save $2k', 'Eventually', 'Done']
            },
            taxseason: {
                name: 'Tax Season',
                columns: ['Today', 'Tomorrow', 'This Week', 'Backlog']
            },
            languageschool: {
                name: 'Language School',
                columns: ['Today', 'Tomorrow', 'This Week', 'Backlog']
            },
            appdev: {
                name: 'App Dev',
                columns: ['Today', 'Tomorrow', 'This Week', 'Backlog']
            },
            immigration: {
                name: 'Immigration/Apartment',
                columns: ['Today', 'Tomorrow', 'This Week', 'Backlog']
            }
        };

        let tasks = {
            fullboard: {},
            taxseason: {
                'Backlog': [
                    { id: ++taskIdCounter, title: 'Complete IRS AFSP Course', person: 'kandra', purpose: 'Get certified', priority: 'high' },
                    { id: ++taskIdCounter, title: 'Set up TaxSlayer account', person: 'kandra', purpose: 'Tax software', priority: 'high' },
                    { id: ++taskIdCounter, title: 'Create client intake form', person: 'kandra', purpose: 'Gather client info', priority: 'medium' },
                    { id: ++taskIdCounter, title: 'Build pricing calculator', person: 'both', purpose: 'Determine fees', priority: 'medium' },
                    { id: ++taskIdCounter, title: 'Set up payment processing', person: 'james', purpose: 'Accept payments', priority: 'high' },
                    { id: ++taskIdCounter, title: 'Design marketing materials', person: 'james', purpose: 'Promote services', priority: 'low' },
                    { id: ++taskIdCounter, title: 'Create social media content', person: 'both', purpose: 'Build presence', priority: 'low' },
                    { id: ++taskIdCounter, title: 'Research local tax laws', person: 'kandra', purpose: 'Stay compliant', priority: 'high' },
                    { id: ++taskIdCounter, title: 'Set up bookkeeping system', person: 'james', purpose: 'Track finances', priority: 'medium' },
                    { id: ++taskIdCounter, title: 'Create client onboarding checklist', person: 'kandra', purpose: 'Streamline process', priority: 'medium' },
                    { id: ++taskIdCounter, title: 'Design business website', person: 'james', purpose: 'Online presence', priority: 'medium' },
                    { id: ++taskIdCounter, title: 'Set up email automation', person: 'james', purpose: 'Client communication', priority: 'low' },
                    { id: ++taskIdCounter, title: 'Create tax prep workflow', person: 'kandra', purpose: 'Efficiency', priority: 'high' }
                ]
            },
            languageschool: {},
            appdev: {},
            immigration: {}
        };

        // Initialize empty columns for all pages
        Object.keys(pages).forEach(page => {
            pages[page].columns.forEach(col => {
                if (!tasks[page][col]) {
                    tasks[page][col] = [];
                }
            });
        });

        function saveData() {
            localStorage.setItem('taskboardData', JSON.stringify({ tasks, pages, taskIdCounter }));
        }

        function loadData() {
            const saved = localStorage.getItem('taskboardData');
            if (saved) {
                const data = JSON.parse(saved);
                if (data.tasks) tasks = data.tasks;
                if (data.pages) {
                    // Merge saved page names with default structure
                    Object.keys(data.pages).forEach(key => {
                        if (pages[key]) {
                            pages[key].name = data.pages[key].name;
                            pages[key].columns = data.pages[key].columns;
                        }
                    });
                }
                if (data.taskIdCounter) taskIdCounter = data.taskIdCounter;
            }
        }

        function editTab(tabButton, pageKey) {
            const span = tabButton.querySelector('.tab-editable');
            const originalText = span.textContent;

            span.contentEditable = true;
            span.focus();

            // Select all text
            const range = document.createRange();
            range.selectNodeContents(span);
            const sel = window.getSelection();
            sel.removeAllRanges();
            sel.addRange(range);

            function finishEdit() {
                span.contentEditable = false;
                const newText = span.textContent.trim();
                if (newText && newText !== originalText) {
                    pages[pageKey].name = newText;
                    saveData();
                } else {
                    span.textContent = originalText;
                }
                span.removeEventListener('blur', finishEdit);
                span.removeEventListener('keydown', handleKey);
            }

            function handleKey(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    span.blur();
                } else if (e.key === 'Escape') {
                    span.textContent = originalText;
                    span.blur();
                }
            }

            span.addEventListener('blur', finishEdit);
            span.addEventListener('keydown', handleKey);
        }

        function makeColumnHeaderEditable(headerElement, pageKey, columnName) {
            if (pageKey === 'fullboard') {
                headerElement.ondblclick = function() {
                    const originalText = headerElement.textContent;
                    headerElement.contentEditable = true;
                    headerElement.focus();

                    // Select all text
                    const range = document.createRange();
                    range.selectNodeContents(headerElement);
                    const sel = window.getSelection();
                    sel.removeAllRanges();
                    sel.addRange(range);

                    function finishEdit() {
                        headerElement.contentEditable = false;
                        const newText = headerElement.textContent.trim();
                        if (newText && newText !== originalText) {
                            // Update column name in pages structure
                            const oldColumns = pages[pageKey].columns;
                            const columnIndex = oldColumns.indexOf(columnName);
                            if (columnIndex !== -1) {
                                oldColumns[columnIndex] = newText;
                                // Update tasks object with new key
                                if (tasks[pageKey][columnName]) {
                                    tasks[pageKey][newText] = tasks[pageKey][columnName];
                                    delete tasks[pageKey][columnName];
                                }
                                saveData();
                                renderBoard();
                            }
                        } else {
                            headerElement.textContent = originalText;
                        }
                        headerElement.onblur = null;
                        headerElement.onkeydown = null;
                    }

                    headerElement.onblur = finishEdit;
                    headerElement.onkeydown = function(e) {
                        if (e.key === 'Enter') {
                            e.preventDefault();
                            headerElement.blur();
                        } else if (e.key === 'Escape') {
                            headerElement.textContent = originalText;
                            headerElement.blur();
                        }
                    };
                };
            }
        }

        function renderBoard() {
            const board = document.getElementById('board');
            board.innerHTML = '';

            let columnsToShow = pages[currentPage].columns;
            let tasksToShow = {};

            if (currentPage === 'fullboard') {
                // Aggregate all tasks from all pages
                Object.keys(pages).forEach(pageKey => {
                    if (pageKey === 'fullboard') return;

                    Object.keys(tasks[pageKey]).forEach(colName => {
                        tasks[pageKey][colName].forEach(task => {
                            // Map to fullboard columns
                            let targetCol = colName;
                            if (colName === 'Tomorrow' || colName === 'This Week') targetCol = 'This Week';
                            if (colName === 'Backlog') targetCol = 'Eventually';

                            if (columnsToShow.includes(targetCol)) {
                                if (!tasksToShow[targetCol]) tasksToShow[targetCol] = [];
                                tasksToShow[targetCol].push({ ...task, sourcePage: pages[pageKey].name });
                            }
                        });
                    });
                });
            } else {
                tasksToShow = tasks[currentPage];
            }

            columnsToShow.forEach(colName => {
                const column = document.createElement('div');
                column.className = 'column';
                column.dataset.column = colName;

                const header = document.createElement('h2');
                header.textContent = colName;
                makeColumnHeaderEditable(header, currentPage, colName);
                column.appendChild(header);

                const columnTasks = tasksToShow[colName] || [];
                columnTasks.forEach(task => {
                    const taskEl = createTaskElement(task, currentPage === 'fullboard');
                    column.appendChild(taskEl);
                });

                // Add "Add Task" button (not on fullboard)
                if (currentPage !== 'fullboard') {
                    const addBtn = document.createElement('button');
                    addBtn.className = 'add-task-btn';
                    addBtn.textContent = '+ Add Task';
                    addBtn.onclick = () => addTask(colName);
                    column.appendChild(addBtn);
                }

                // Drag and drop
                column.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    column.style.background = 'linear-gradient(135deg, #ffd6e0 0%, #ffa6bf 100%)';
                });

                column.addEventListener('dragleave', () => {
                    column.style.background = '';
                });

                column.addEventListener('drop', (e) => {
                    e.preventDefault();
                    column.style.background = '';
                    if (draggedTask && currentPage !== 'fullboard') {
                        moveTaskBetweenColumns(draggedTask.page, draggedTask.fromColumn, colName, draggedTask.task);
                    }
                });

                board.appendChild(column);
            });

            updateStats();
        }

        function createTaskElement(task, isReadOnly = false) {
            const taskEl = document.createElement('div');
            taskEl.className = 'task';
            taskEl.draggable = !isReadOnly;
            taskEl.dataset.taskId = task.id;

            if (!isReadOnly) {
                taskEl.addEventListener('dragstart', (e) => {
                    taskEl.classList.add('dragging');
                    const column = taskEl.closest('.column').dataset.column;
                    draggedTask = { page: currentPage, fromColumn: column, task: task };
                });

                taskEl.addEventListener('dragend', () => {
                    taskEl.classList.remove('dragging');
                    draggedTask = null;
                });

                // Touch support for mobile
                let touchStartY = 0;
                taskEl.addEventListener('touchstart', (e) => {
                    touchStartY = e.touches[0].clientY;
                    taskEl.classList.add('dragging');
                });

                taskEl.addEventListener('touchend', () => {
                    taskEl.classList.remove('dragging');
                });
            }

            const header = document.createElement('div');
            header.className = 'task-header';

            const title = document.createElement('div');
            title.className = 'task-title';
            title.textContent = task.title;

            if (!isReadOnly) {
                title.contentEditable = true;
                title.addEventListener('blur', () => {
                    task.title = title.textContent.trim() || 'Untitled Task';
                    saveData();
                });
                title.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        title.blur();
                    }
                });
            }

            const priority = document.createElement('span');
            priority.className = `priority ${task.priority || 'medium'}`;
            priority.textContent = (task.priority || 'medium').toUpperCase();

            if (!isReadOnly) {
                priority.onclick = () => {
                    const priorities = ['low', 'medium', 'high'];
                    const currentIndex = priorities.indexOf(task.priority || 'medium');
                    task.priority = priorities[(currentIndex + 1) % 3];
                    saveData();
                    renderBoard();
                };
            }

            header.appendChild(title);
            header.appendChild(priority);

            if (task.sourcePage) {
                const badge = document.createElement('span');
                badge.className = 'source-badge';
                badge.textContent = task.sourcePage;
                header.appendChild(badge);
            }

            const meta = document.createElement('div');
            meta.className = 'task-meta';

            const personBadge = document.createElement('span');
            personBadge.className = `person-badge ${task.person || 'both'}`;
            const personNames = { james: 'James', kandra: 'Kandra', both: 'Both' };
            personBadge.textContent = personNames[task.person || 'both'];

            if (!isReadOnly) {
                personBadge.onclick = () => {
                    const persons = ['james', 'kandra', 'both'];
                    const currentIndex = persons.indexOf(task.person || 'both');
                    task.person = persons[(currentIndex + 1) % 3];
                    saveData();
                    renderBoard();
                };
            }

            const purpose = document.createElement('div');
            purpose.className = 'task-purpose';
            purpose.textContent = task.purpose || 'No description';

            if (!isReadOnly) {
                purpose.contentEditable = true;
                purpose.addEventListener('blur', () => {
                    task.purpose = purpose.textContent.trim();
                    saveData();
                });
                purpose.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        purpose.blur();
                    }
                });
            }

            meta.appendChild(personBadge);
            meta.appendChild(purpose);

            taskEl.appendChild(header);
            taskEl.appendChild(meta);

            if (!isReadOnly) {
                const actions = document.createElement('div');
                actions.className = 'task-actions';

                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'task-btn delete-btn';
                deleteBtn.textContent = 'üóëÔ∏è Delete';
                deleteBtn.onclick = () => deleteTask(task.id);

                const moveBtn = document.createElement('button');
                moveBtn.className = 'task-btn move-btn';
                moveBtn.textContent = '‚ÜîÔ∏è Move';
                moveBtn.onclick = () => showMoveModal(task);

                actions.appendChild(deleteBtn);
                actions.appendChild(moveBtn);
                taskEl.appendChild(actions);
            }

            return taskEl;
        }

        function addTask(column) {
            const newTask = {
                id: ++taskIdCounter,
                title: 'New Task',
                person: 'both',
                purpose: '',
                priority: 'medium'
            };

            if (!tasks[currentPage][column]) {
                tasks[currentPage][column] = [];
            }
            tasks[currentPage][column].push(newTask);
            saveData();
            renderBoard();

            // Auto-focus the new task title
            setTimeout(() => {
                const taskEl = document.querySelector(`[data-task-id="${newTask.id}"] .task-title`);
                if (taskEl) {
                    taskEl.focus();
                    document.execCommand('selectAll', false, null);
                }
            }, 100);
        }

        function deleteTask(taskId) {
            Object.keys(tasks[currentPage]).forEach(colName => {
                tasks[currentPage][colName] = tasks[currentPage][colName].filter(t => t.id !== taskId);
            });
            saveData();
            renderBoard();
        }

        function moveTaskBetweenColumns(page, fromColumn, toColumn, task) {
            if (fromColumn === toColumn) return;

            // Remove from old column
            tasks[page][fromColumn] = tasks[page][fromColumn].filter(t => t.id !== task.id);

            // Add to new column
            if (!tasks[page][toColumn]) {
                tasks[page][toColumn] = [];
            }
            tasks[page][toColumn].push(task);

            saveData();
            renderBoard();
        }

        function showMoveModal(task) {
            currentMoveTask = task;
            const modal = document.getElementById('moveModal');
            const options = document.getElementById('moveOptions');
            options.innerHTML = '';

            const currentColumn = Object.keys(tasks[currentPage]).find(col =>
                tasks[currentPage][col].some(t => t.id === task.id)
            );

            pages[currentPage].columns.forEach(colName => {
                if (colName !== currentColumn) {
                    const li = document.createElement('li');
                    li.textContent = colName;
                    li.onclick = () => {
                        moveTaskBetweenColumns(currentPage, currentColumn, colName, task);
                        closeMoveModal();
                    };
                    options.appendChild(li);
                }
            });

            modal.classList.add('show');
        }

        function closeMoveModal() {
            document.getElementById('moveModal').classList.remove('show');
            currentMoveTask = null;
        }

        function handleBrainDumpEnter(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                processBrainDump();
            }
        }

        function processBrainDump() {
            const input = document.getElementById('brainDumpInput');
            const text = input.value.trim();
            if (!text) return;

            // Parse the text
            let column = 'Backlog';
            let priority = 'medium';
            let person = 'both';
            let title = text;

            // Detect column
            if (/(today|right now|asap)/i.test(text)) column = 'Today';
            else if (/(tomorrow|tmr|tmrw)/i.test(text)) column = 'Tomorrow';
            else if (/(this week|soon)/i.test(text)) column = 'This Week';
            else if (/(this month)/i.test(text)) column = pages[currentPage].columns.includes('This Month') ? 'This Month' : 'This Week';
            else if (/(eventually|someday|later)/i.test(text)) column = 'Eventually';

            // Detect priority
            if (/(urgent|important|!!!)/i.test(text)) priority = 'high';
            else if (/(low priority|maybe)/i.test(text)) priority = 'low';

            // Detect person
            if (/\bjames\b/i.test(text)) person = 'james';
            else if (/\bkandra\b/i.test(text)) person = 'kandra';
            else if (/\bboth\b/i.test(text)) person = 'both';

            // Clean up title
            title = title
                .replace(/(today|tomorrow|tmr|tmrw|right now|asap|this week|soon|this month|eventually|someday|later|urgent|important|!!!|low priority|maybe|james|kandra|both)/gi, '')
                .trim();

            // Map to current page columns
            if (currentPage !== 'fullboard' && !pages[currentPage].columns.includes(column)) {
                if (column === 'Eventually') column = 'Backlog';
                if (column === 'This Month') column = 'This Week';
            }

            // Create task
            const newTask = {
                id: ++taskIdCounter,
                title: title || 'New Task',
                person: person,
                purpose: '',
                priority: priority
            };

            if (!tasks[currentPage][column]) {
                tasks[currentPage][column] = [];
            }
            tasks[currentPage][column].push(newTask);

            input.value = '';
            saveData();
            renderBoard();
        }

        function suggestNextTask() {
            // Get all tasks from current page except Done
            let allTasks = [];
            Object.keys(tasks[currentPage]).forEach(colName => {
                if (colName !== 'Done') {
                    tasks[currentPage][colName].forEach(task => {
                        allTasks.push({ ...task, column: colName });
                    });
                }
            });

            if (allTasks.length === 0) {
                alert('üéâ No tasks left! Time to celebrate!');
                return;
            }

            // Score tasks
            const scores = allTasks.map(task => {
                let score = 0;

                // Column urgency
                if (task.column === 'Today') score += 100;
                else if (task.column === 'Tomorrow') score += 50;
                else if (task.column === 'This Week') score += 25;
                else if (task.column === 'This Month') score += 10;

                // Priority
                if (task.priority === 'high') score += 30;
                else if (task.priority === 'medium') score += 15;
                else score += 5;

                return { task, score };
            });

            // Sort by score
            scores.sort((a, b) => b.score - a.score);
            const winner = scores[0].task;

            alert(`üéØ DO THIS NOW:\n\n"${winner.title}"\n\nüìç ${winner.column}\nüë§ ${winner.person.toUpperCase()}\n‚ö° ${winner.priority.toUpperCase()} priority${winner.purpose ? '\nüìù ' + winner.purpose : ''}`);
        }

        function updateStats() {
            let todayTasks = 0;
            let doneTasks = 0;
            let totalTasks = 0;

            Object.keys(tasks[currentPage]).forEach(colName => {
                const colTasks = tasks[currentPage][colName] || [];
                totalTasks += colTasks.length;

                if (colName === 'Today') todayTasks = colTasks.length;
                if (colName === 'Done') doneTasks = colTasks.length;
            });

            document.getElementById('todayCount').textContent = todayTasks;
            document.getElementById('doneCount').textContent = doneTasks;

            const progress = totalTasks > 0 ? Math.round((doneTasks / totalTasks) * 100) : 0;
            document.getElementById('progressPercent').textContent = progress;
        }

        function startTimer() {
            if (timerInterval) return;

            timerInterval = setInterval(() => {
                timerSeconds--;
                updateTimerDisplay();

                if (timerSeconds <= 0) {
                    clearInterval(timerInterval);
                    timerInterval = null;

                    // Play alert
                    const audio = document.getElementById('timerAlert');
                    audio.play().catch(() => {});

                    if (isWorkTime) {
                        alert('üéâ Work session complete! Take a 5 minute break!');
                        timerSeconds = 5 * 60;
                        isWorkTime = false;
                    } else {
                        alert('‚è∞ Break over! Ready for another 25 minutes?');
                        timerSeconds = 25 * 60;
                        isWorkTime = true;
                    }
                    updateTimerDisplay();
                }
            }, 1000);
        }

        function pauseTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
        }

        function resetTimer() {
            pauseTimer();
            timerSeconds = 25 * 60;
            isWorkTime = true;
            updateTimerDisplay();
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timerSeconds / 60);
            const seconds = timerSeconds % 60;
            document.getElementById('timer').textContent =
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        function switchPage(page) {
            currentPage = page;

            // Update active tab
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');

            renderBoard();
        }

        // Initialize
        loadData();
        renderBoard();
    </script>
</body>
</html>